<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calfix Logging Database Schema</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 40px 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        header {
            background: linear-gradient(135deg, #5f72be 0%, #9921e8 100%);
            padding: 40px;
            text-align: center;
            color: white;
        }

        h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
        }

        .subtitle {
            font-size: 1.2em;
            opacity: 0.95;
        }

        .content {
            padding: 40px;
        }

        .section {
            margin-bottom: 50px;
        }

        h2 {
            color: #333;
            font-size: 1.8em;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #667eea;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .icon {
            width: 30px;
            height: 30px;
        }

        .schema-diagram {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 10px;
            margin: 20px 0;
            overflow-x: auto;
        }

        .table-card {
            background: white;
            border: 2px solid #e1e4e8;
            border-radius: 10px;
            margin-bottom: 30px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .table-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .table-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 15px 20px;
            color: white;
            font-weight: bold;
            font-size: 1.2em;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .table-type {
            background: rgba(255, 255, 255, 0.2);
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 0.8em;
            text-transform: uppercase;
        }

        .table-description {
            padding: 15px 20px;
            background: #f8f9fa;
            border-bottom: 1px solid #e1e4e8;
            color: #586069;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th {
            background: #f1f3f5;
            padding: 12px 15px;
            text-align: left;
            font-weight: 600;
            color: #333;
            font-size: 0.9em;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        td {
            padding: 12px 15px;
            border-bottom: 1px solid #e1e4e8;
            color: #333;
        }

        tr:last-child td {
            border-bottom: none;
        }

        tr:hover {
            background: #f8f9fa;
        }

        .column-name {
            font-weight: 600;
            color: #0366d6;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 0.95em;
        }

        .data-type {
            color: #6f42c1;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 0.9em;
            background: #f6f8fa;
            padding: 2px 6px;
            border-radius: 3px;
        }

        .constraint {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.85em;
            margin: 0 2px;
            font-weight: 500;
        }

        .primary-key {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffc107;
        }

        .foreign-key {
            background: #cfe2ff;
            color: #084298;
            border: 1px solid #6ea8fe;
        }

        .not-null {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .unique {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #9ec5ce;
        }

        .index {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .default {
            background: #e2e3e5;
            color: #383d41;
            border: 1px solid #d6d8db;
        }

        .er-diagram {
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            margin: 30px 0;
        }

        svg {
            max-width: 100%;
            height: auto;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 25px;
            border-radius: 10px;
            color: white;
            text-align: center;
        }

        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 1em;
            opacity: 0.9;
        }

        .migration-code {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 0.9em;
            line-height: 1.6;
            margin: 20px 0;
        }

        .sql-keyword {
            color: #66d9ef;
            font-weight: bold;
        }

        .sql-type {
            color: #a6e22e;
        }

        .sql-string {
            color: #e6db74;
        }

        .sql-comment {
            color: #75715e;
            font-style: italic;
        }

        .relationships {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .relationship-card {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .relationship-title {
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }

        .relationship-detail {
            color: #586069;
            font-size: 0.9em;
        }

        .tab-container {
            margin: 30px 0;
        }

        .tabs {
            display: flex;
            gap: 2px;
            background: #f1f3f5;
            padding: 2px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .tab {
            padding: 10px 20px;
            background: transparent;
            border: none;
            cursor: pointer;
            border-radius: 6px;
            font-size: 1em;
            transition: all 0.3s;
        }

        .tab.active {
            background: white;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            color: #667eea;
            font-weight: 600;
        }

        .tab:hover:not(.active) {
            background: rgba(255, 255, 255, 0.5);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.85em;
            font-weight: 500;
            margin-left: 5px;
        }

        .badge-new {
            background: #28a745;
            color: white;
        }

        .badge-enhanced {
            background: #ffc107;
            color: #333;
        }

        .badge-existing {
            background: #6c757d;
            color: white;
        }

        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }

            h1 {
                font-size: 1.8em;
            }

            .content {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ðŸ“Š Calfix Logging Database Schema</h1>
            <div class="subtitle">Comprehensive User Action Tracking System</div>
        </header>

        <div class="content">
            <!-- Overview Section -->
            <div class="section">
                <h2>
                    <span>ðŸ“ˆ</span>
                    Schema Overview
                </h2>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number">11</div>
                        <div class="stat-label">Total Tables</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">4</div>
                        <div class="stat-label">New Tables</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">80+</div>
                        <div class="stat-label">Action Types</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">0</div>
                        <div class="stat-label">PII Fields Stored</div>
                    </div>
                </div>
            </div>

            <!-- Entity Relationship Diagram -->
            <div class="section">
                <h2>
                    <span>ðŸ”—</span>
                    Entity Relationship Diagram
                </h2>

                <div class="er-diagram">
                    <svg viewBox="0 0 1200 800" xmlns="http://www.w3.org/2000/svg">
                        <!-- Users table -->
                        <rect x="500" y="50" width="200" height="150" fill="#e8f4fd" stroke="#667eea" stroke-width="2" rx="5"/>
                        <text x="600" y="80" text-anchor="middle" font-weight="bold" font-size="16">users</text>
                        <line x1="510" y1="90" x2="690" y2="90" stroke="#667eea" stroke-width="1"/>
                        <text x="520" y="110" font-size="12">id (PK)</text>
                        <text x="520" y="130" font-size="12">email</text>
                        <text x="520" y="150" font-size="12">subscription_tier</text>
                        <text x="520" y="170" font-size="12">created_at</text>

                        <!-- User Actions table (Enhanced) -->
                        <rect x="200" y="300" width="220" height="200" fill="#fff3cd" stroke="#ffc107" stroke-width="2" rx="5"/>
                        <text x="310" y="330" text-anchor="middle" font-weight="bold" font-size="16">user_actions</text>
                        <text x="310" y="350" text-anchor="middle" font-size="10" fill="#856404">(ENHANCED)</text>
                        <line x1="210" y1="360" x2="410" y2="360" stroke="#ffc107" stroke-width="1"/>
                        <text x="220" y="380" font-size="12">id (PK)</text>
                        <text x="220" y="400" font-size="12">user_id (FK)</text>
                        <text x="220" y="420" font-size="12">action_category</text>
                        <text x="220" y="440" font-size="12">action_type</text>
                        <text x="220" y="460" font-size="12">session_id (FK)</text>
                        <text x="220" y="480" font-size="12">metadata</text>

                        <!-- User Sessions table (New) -->
                        <rect x="50" y="100" width="200" height="140" fill="#d4edda" stroke="#28a745" stroke-width="2" rx="5"/>
                        <text x="150" y="130" text-anchor="middle" font-weight="bold" font-size="16">user_sessions</text>
                        <text x="150" y="150" text-anchor="middle" font-size="10" fill="#155724">(NEW)</text>
                        <line x1="60" y1="160" x2="240" y2="160" stroke="#28a745" stroke-width="1"/>
                        <text x="70" y="180" font-size="12">id (PK)</text>
                        <text x="70" y="200" font-size="12">user_id (FK)</text>
                        <text x="70" y="220" font-size="12">started_at</text>

                        <!-- Action Types table (New) -->
                        <rect x="500" y="400" width="200" height="140" fill="#d4edda" stroke="#28a745" stroke-width="2" rx="5"/>
                        <text x="600" y="430" text-anchor="middle" font-weight="bold" font-size="16">action_types</text>
                        <text x="600" y="450" text-anchor="middle" font-size="10" fill="#155724">(NEW)</text>
                        <line x1="510" y1="460" x2="690" y2="460" stroke="#28a745" stroke-width="1"/>
                        <text x="520" y="480" font-size="12">id (PK)</text>
                        <text x="520" y="500" font-size="12">category</text>
                        <text x="520" y="520" font-size="12">action_type</text>

                        <!-- Action Errors table (New) -->
                        <rect x="200" y="600" width="200" height="140" fill="#d4edda" stroke="#28a745" stroke-width="2" rx="5"/>
                        <text x="300" y="630" text-anchor="middle" font-weight="bold" font-size="16">action_errors</text>
                        <text x="300" y="650" text-anchor="middle" font-size="10" fill="#155724">(NEW)</text>
                        <line x1="210" y1="660" x2="390" y2="660" stroke="#28a745" stroke-width="1"/>
                        <text x="220" y="680" font-size="12">id (PK)</text>
                        <text x="220" y="700" font-size="12">action_id (FK)</text>
                        <text x="220" y="720" font-size="12">error_type</text>

                        <!-- Managed Calendars table -->
                        <rect x="800" y="300" width="200" height="140" fill="#e8f4fd" stroke="#667eea" stroke-width="2" rx="5"/>
                        <text x="900" y="330" text-anchor="middle" font-weight="bold" font-size="16">managed_calendars</text>
                        <line x1="810" y1="340" x2="990" y2="340" stroke="#667eea" stroke-width="1"/>
                        <text x="820" y="360" font-size="12">id (PK)</text>
                        <text x="820" y="380" font-size="12">user_id (FK)</text>
                        <text x="820" y="400" font-size="12">calendar_id</text>
                        <text x="820" y="420" font-size="12">calendar_name</text>

                        <!-- Relationships -->
                        <!-- users -> user_actions -->
                        <line x1="500" y1="150" x2="350" y2="300" stroke="#333" stroke-width="1" stroke-dasharray="5,5"/>
                        <polygon points="350,300 355,295 355,305" fill="#333"/>

                        <!-- users -> user_sessions -->
                        <line x1="500" y1="100" x2="250" y2="170" stroke="#333" stroke-width="1" stroke-dasharray="5,5"/>
                        <polygon points="250,170 255,165 255,175" fill="#333"/>

                        <!-- user_sessions -> user_actions -->
                        <line x1="150" y1="240" x2="260" y2="300" stroke="#333" stroke-width="1" stroke-dasharray="5,5"/>
                        <polygon points="260,300 255,295 265,295" fill="#333"/>

                        <!-- user_actions -> action_errors -->
                        <line x1="310" y1="500" x2="300" y2="600" stroke="#333" stroke-width="1" stroke-dasharray="5,5"/>
                        <polygon points="300,600 295,595 305,595" fill="#333"/>

                        <!-- users -> managed_calendars -->
                        <line x1="700" y1="150" x2="850" y2="300" stroke="#333" stroke-width="1" stroke-dasharray="5,5"/>
                        <polygon points="850,300 845,295 845,305" fill="#333"/>

                        <!-- Legend -->
                        <rect x="950" y="600" width="220" height="140" fill="#f8f9fa" stroke="#dee2e6" stroke-width="1" rx="5"/>
                        <text x="1060" y="625" text-anchor="middle" font-weight="bold" font-size="14">Legend</text>
                        <rect x="960" y="640" width="30" height="20" fill="#d4edda" stroke="#28a745" stroke-width="2"/>
                        <text x="1000" y="655" font-size="12">New Table</text>
                        <rect x="960" y="670" width="30" height="20" fill="#fff3cd" stroke="#ffc107" stroke-width="2"/>
                        <text x="1000" y="685" font-size="12">Enhanced Table</text>
                        <rect x="960" y="700" width="30" height="20" fill="#e8f4fd" stroke="#667eea" stroke-width="2"/>
                        <text x="1000" y="715" font-size="12">Existing Table</text>
                    </svg>
                </div>
            </div>

            <!-- Detailed Schema Tables -->
            <div class="section">
                <h2>
                    <span>ðŸ“‹</span>
                    Detailed Table Schemas
                </h2>

                <div class="tab-container">
                    <div class="tabs">
                        <button class="tab active" onclick="showTab('new')">New Tables</button>
                        <button class="tab" onclick="showTab('enhanced')">Enhanced Tables</button>
                        <button class="tab" onclick="showTab('existing')">Related Existing Tables</button>
                    </div>

                    <!-- New Tables -->
                    <div id="new" class="tab-content active">
                        <!-- User Sessions Table -->
                        <div class="table-card">
                            <div class="table-header">
                                <span>user_sessions</span>
                                <span class="table-type">New Table</span>
                            </div>
                            <div class="table-description">
                                Tracks user sessions to group actions and understand user journeys. Each session represents a continuous period of user activity.
                            </div>
                            <table>
                                <thead>
                                    <tr>
                                        <th>Column</th>
                                        <th>Type</th>
                                        <th>Constraints</th>
                                        <th>Description</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td class="column-name">id</td>
                                        <td class="data-type">TEXT</td>
                                        <td>
                                            <span class="constraint primary-key">PRIMARY KEY</span>
                                        </td>
                                        <td>Unique session identifier (timestamp-random)</td>
                                    </tr>
                                    <tr>
                                        <td class="column-name">user_id</td>
                                        <td class="data-type">TEXT</td>
                                        <td>
                                            <span class="constraint not-null">NOT NULL</span>
                                            <span class="constraint foreign-key">FK â†’ users.id</span>
                                            <span class="constraint index">INDEXED</span>
                                        </td>
                                        <td>Reference to user</td>
                                    </tr>
                                    <tr>
                                        <td class="column-name">started_at</td>
                                        <td class="data-type">TIMESTAMPTZ</td>
                                        <td>
                                            <span class="constraint default">DEFAULT NOW()</span>
                                            <span class="constraint index">INDEXED</span>
                                        </td>
                                        <td>Session start time</td>
                                    </tr>
                                    <tr>
                                        <td class="column-name">ended_at</td>
                                        <td class="data-type">TIMESTAMPTZ</td>
                                        <td></td>
                                        <td>Session end time (null if active)</td>
                                    </tr>
                                    <tr>
                                        <td class="column-name">total_actions</td>
                                        <td class="data-type">INTEGER</td>
                                        <td>
                                            <span class="constraint default">DEFAULT 0</span>
                                        </td>
                                        <td>Count of actions in session</td>
                                    </tr>
                                    <tr>
                                        <td class="column-name">total_time_saved_minutes</td>
                                        <td class="data-type">INTEGER</td>
                                        <td>
                                            <span class="constraint default">DEFAULT 0</span>
                                        </td>
                                        <td>Total time saved in session</td>
                                    </tr>
                                    <tr>
                                        <td class="column-name">ip_hash</td>
                                        <td class="data-type">TEXT</td>
                                        <td></td>
                                        <td>Hashed IP for geographic analytics (no PII)</td>
                                    </tr>
                                    <tr>
                                        <td class="column-name">user_agent</td>
                                        <td class="data-type">TEXT</td>
                                        <td></td>
                                        <td>Browser/device information</td>
                                    </tr>
                                    <tr>
                                        <td class="column-name">metadata</td>
                                        <td class="data-type">JSONB</td>
                                        <td></td>
                                        <td>Additional session context</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        <!-- Action Types Table -->
                        <div class="table-card">
                            <div class="table-header">
                                <span>action_types</span>
                                <span class="table-type">New Table</span>
                            </div>
                            <div class="table-description">
                                Reference table for standardized action types with expected performance metrics and time savings.
                            </div>
                            <table>
                                <thead>
                                    <tr>
                                        <th>Column</th>
                                        <th>Type</th>
                                        <th>Constraints</th>
                                        <th>Description</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td class="column-name">id</td>
                                        <td class="data-type">UUID</td>
                                        <td>
                                            <span class="constraint primary-key">PRIMARY KEY</span>
                                            <span class="constraint default">DEFAULT gen_random_uuid()</span>
                                        </td>
                                        <td>Unique identifier</td>
                                    </tr>
                                    <tr>
                                        <td class="column-name">category</td>
                                        <td class="data-type">TEXT</td>
                                        <td>
                                            <span class="constraint not-null">NOT NULL</span>
                                        </td>
                                        <td>Action category (auth, event, workflow, etc.)</td>
                                    </tr>
                                    <tr>
                                        <td class="column-name">action_type</td>
                                        <td class="data-type">TEXT</td>
                                        <td>
                                            <span class="constraint not-null">NOT NULL</span>
                                            <span class="constraint unique">UNIQUE</span>
                                        </td>
                                        <td>Specific action type identifier</td>
                                    </tr>
                                    <tr>
                                        <td class="column-name">description</td>
                                        <td class="data-type">TEXT</td>
                                        <td></td>
                                        <td>Human-readable description</td>
                                    </tr>
                                    <tr>
                                        <td class="column-name">expected_duration_ms</td>
                                        <td class="data-type">INTEGER</td>
                                        <td></td>
                                        <td>Expected action duration for monitoring</td>
                                    </tr>
                                    <tr>
                                        <td class="column-name">time_saved_minutes</td>
                                        <td class="data-type">INTEGER</td>
                                        <td></td>
                                        <td>Default time saved by this action</td>
                                    </tr>
                                    <tr>
                                        <td class="column-name">created_at</td>
                                        <td class="data-type">TIMESTAMPTZ</td>
                                        <td>
                                            <span class="constraint default">DEFAULT NOW()</span>
                                        </td>
                                        <td>Record creation timestamp</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        <!-- Action Errors Table -->
                        <div class="table-card">
                            <div class="table-header">
                                <span>action_errors</span>
                                <span class="table-type">New Table</span>
                            </div>
                            <div class="table-description">
                                Detailed error tracking for debugging and monitoring system health.
                            </div>
                            <table>
                                <thead>
                                    <tr>
                                        <th>Column</th>
                                        <th>Type</th>
                                        <th>Constraints</th>
                                        <th>Description</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td class="column-name">id</td>
                                        <td class="data-type">UUID</td>
                                        <td>
                                            <span class="constraint primary-key">PRIMARY KEY</span>
                                            <span class="constraint default">DEFAULT gen_random_uuid()</span>
                                        </td>
                                        <td>Unique error record identifier</td>
                                    </tr>
                                    <tr>
                                        <td class="column-name">action_id</td>
                                        <td class="data-type">UUID</td>
                                        <td>
                                            <span class="constraint foreign-key">FK â†’ user_actions.id</span>
                                            <span class="constraint index">INDEXED</span>
                                        </td>
                                        <td>Reference to failed action</td>
                                    </tr>
                                    <tr>
                                        <td class="column-name">error_type</td>
                                        <td class="data-type">TEXT</td>
                                        <td>
                                            <span class="constraint not-null">NOT NULL</span>
                                            <span class="constraint index">INDEXED</span>
                                        </td>
                                        <td>Error category (auth, api, network, validation, permission)</td>
                                    </tr>
                                    <tr>
                                        <td class="column-name">error_code</td>
                                        <td class="data-type">TEXT</td>
                                        <td>
                                            <span class="constraint not-null">NOT NULL</span>
                                        </td>
                                        <td>Standardized error code</td>
                                    </tr>
                                    <tr>
                                        <td class="column-name">error_message</td>
                                        <td class="data-type">TEXT</td>
                                        <td></td>
                                        <td>Sanitized error message (no PII)</td>
                                    </tr>
                                    <tr>
                                        <td class="column-name">stack_trace</td>
                                        <td class="data-type">TEXT</td>
                                        <td></td>
                                        <td>Sanitized stack trace for debugging</td>
                                    </tr>
                                    <tr>
                                        <td class="column-name">context</td>
                                        <td class="data-type">JSONB</td>
                                        <td></td>
                                        <td>Additional debugging context (IDs only)</td>
                                    </tr>
                                    <tr>
                                        <td class="column-name">created_at</td>
                                        <td class="data-type">TIMESTAMPTZ</td>
                                        <td>
                                            <span class="constraint default">DEFAULT NOW()</span>
                                            <span class="constraint index">INDEXED</span>
                                        </td>
                                        <td>Error occurrence timestamp</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Enhanced Tables -->
                    <div id="enhanced" class="tab-content">
                        <!-- Enhanced User Actions Table -->
                        <div class="table-card">
                            <div class="table-header">
                                <span>user_actions (Enhanced)</span>
                                <span class="table-type">Enhanced Table</span>
                            </div>
                            <div class="table-description">
                                Core logging table enhanced with additional columns for comprehensive action tracking. All user interactions are logged here with privacy-first design (IDs only, no PII).
                            </div>
                            <table>
                                <thead>
                                    <tr>
                                        <th>Column</th>
                                        <th>Type</th>
                                        <th>Constraints</th>
                                        <th>Description</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td class="column-name">id</td>
                                        <td class="data-type">UUID</td>
                                        <td>
                                            <span class="constraint primary-key">PRIMARY KEY</span>
                                            <span class="constraint default">DEFAULT gen_random_uuid()</span>
                                        </td>
                                        <td>Unique action identifier</td>
                                    </tr>
                                    <tr>
                                        <td class="column-name">user_id</td>
                                        <td class="data-type">TEXT</td>
                                        <td>
                                            <span class="constraint not-null">NOT NULL</span>
                                            <span class="constraint foreign-key">FK â†’ users.id</span>
                                            <span class="constraint index">INDEXED</span>
                                        </td>
                                        <td>User who performed action</td>
                                    </tr>
                                    <tr>
                                        <td class="column-name">calendar_id</td>
                                        <td class="data-type">TEXT</td>
                                        <td>
                                            <span class="constraint index">INDEXED</span>
                                        </td>
                                        <td>Calendar being managed</td>
                                    </tr>
                                    <tr>
                                        <td class="column-name">action_category</td>
                                        <td class="data-type">TEXT</td>
                                        <td>
                                            <span class="constraint not-null">NOT NULL</span>
                                        </td>
                                        <td>Category (auth, view, event, workflow, etc.)</td>
                                    </tr>
                                    <tr>
                                        <td class="column-name">action_type</td>
                                        <td class="data-type">TEXT</td>
                                        <td>
                                            <span class="constraint not-null">NOT NULL</span>
                                            <span class="constraint index">INDEXED</span>
                                        </td>
                                        <td>Specific action (sign_in, create_buffer, etc.)</td>
                                    </tr>
                                    <tr>
                                        <td class="column-name">action_status</td>
                                        <td class="data-type">TEXT</td>
                                        <td>
                                            <span class="constraint not-null">NOT NULL</span>
                                            <span class="constraint default">DEFAULT 'initiated'</span>
                                            <span class="constraint index">INDEXED</span>
                                        </td>
                                        <td>Status (initiated, success, failed, partial)</td>
                                    </tr>
                                    <tr>
                                        <td class="column-name">event_id</td>
                                        <td class="data-type">TEXT</td>
                                        <td></td>
                                        <td>Google Calendar event ID if applicable</td>
                                    </tr>
                                    <tr>
                                        <td class="column-name">target_calendar_id</td>
                                        <td class="data-type">TEXT</td>
                                        <td></td>
                                        <td>Target calendar for cross-calendar operations</td>
                                    </tr>
                                    <tr>
                                        <td class="column-name">workflow_id</td>
                                        <td class="data-type">TEXT</td>
                                        <td></td>
                                        <td>Workflow execution identifier</td>
                                    </tr>
                                    <tr>
                                        <td class="column-name">session_id</td>
                                        <td class="data-type">TEXT</td>
                                        <td>
                                            <span class="constraint foreign-key">FK â†’ user_sessions.id</span>
                                            <span class="constraint index">INDEXED</span>
                                        </td>
                                        <td>Session this action belongs to</td>
                                    </tr>
                                    <tr>
                                        <td class="column-name">time_saved_minutes</td>
                                        <td class="data-type">INTEGER</td>
                                        <td>
                                            <span class="constraint default">DEFAULT 0</span>
                                        </td>
                                        <td>Time saved by this action</td>
                                    </tr>
                                    <tr>
                                        <td class="column-name">events_affected</td>
                                        <td class="data-type">INTEGER</td>
                                        <td>
                                            <span class="constraint default">DEFAULT 0</span>
                                        </td>
                                        <td>Number of events created/modified/deleted</td>
                                    </tr>
                                    <tr>
                                        <td class="column-name">duration_ms</td>
                                        <td class="data-type">INTEGER</td>
                                        <td></td>
                                        <td>How long the action took to complete</td>
                                    </tr>
                                    <tr>
                                        <td class="column-name">error_code</td>
                                        <td class="data-type">TEXT</td>
                                        <td></td>
                                        <td>Error code if action failed</td>
                                    </tr>
                                    <tr>
                                        <td class="column-name">error_message</td>
                                        <td class="data-type">TEXT</td>
                                        <td></td>
                                        <td>Sanitized error message (no PII)</td>
                                    </tr>
                                    <tr>
                                        <td class="column-name">retry_count</td>
                                        <td class="data-type">INTEGER</td>
                                        <td>
                                            <span class="constraint default">DEFAULT 0</span>
                                        </td>
                                        <td>Number of retry attempts</td>
                                    </tr>
                                    <tr>
                                        <td class="column-name">metadata</td>
                                        <td class="data-type">JSONB</td>
                                        <td></td>
                                        <td>Flexible field for action-specific data (IDs only)</td>
                                    </tr>
                                    <tr>
                                        <td class="column-name">request_params</td>
                                        <td class="data-type">JSONB</td>
                                        <td></td>
                                        <td>Sanitized request parameters (IDs only)</td>
                                    </tr>
                                    <tr>
                                        <td class="column-name">response_data</td>
                                        <td class="data-type">JSONB</td>
                                        <td></td>
                                        <td>Sanitized response data (counts, IDs only)</td>
                                    </tr>
                                    <tr>
                                        <td class="column-name">user_agent</td>
                                        <td class="data-type">TEXT</td>
                                        <td></td>
                                        <td>Browser/device information</td>
                                    </tr>
                                    <tr>
                                        <td class="column-name">ip_hash</td>
                                        <td class="data-type">TEXT</td>
                                        <td></td>
                                        <td>Hashed IP for geographic analytics</td>
                                    </tr>
                                    <tr>
                                        <td class="column-name">created_at</td>
                                        <td class="data-type">TIMESTAMPTZ</td>
                                        <td>
                                            <span class="constraint default">DEFAULT NOW()</span>
                                            <span class="constraint index">INDEXED</span>
                                        </td>
                                        <td>When action was initiated</td>
                                    </tr>
                                    <tr>
                                        <td class="column-name">completed_at</td>
                                        <td class="data-type">TIMESTAMPTZ</td>
                                        <td></td>
                                        <td>When action completed (for duration tracking)</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Existing Tables -->
                    <div id="existing" class="tab-content">
                        <!-- Users Table -->
                        <div class="table-card">
                            <div class="table-header">
                                <span>users</span>
                                <span class="table-type">Existing Table</span>
                            </div>
                            <div class="table-description">
                                Core user table that all logging tables reference. Contains user authentication and subscription information.
                            </div>
                            <table>
                                <thead>
                                    <tr>
                                        <th>Column</th>
                                        <th>Type</th>
                                        <th>Constraints</th>
                                        <th>Description</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td class="column-name">id</td>
                                        <td class="data-type">TEXT</td>
                                        <td>
                                            <span class="constraint primary-key">PRIMARY KEY</span>
                                        </td>
                                        <td>Unique user identifier (from Clerk)</td>
                                    </tr>
                                    <tr>
                                        <td class="column-name">email</td>
                                        <td class="data-type">TEXT</td>
                                        <td>
                                            <span class="constraint unique">UNIQUE</span>
                                        </td>
                                        <td>User email address</td>
                                    </tr>
                                    <tr>
                                        <td class="column-name">subscription_tier</td>
                                        <td class="data-type">TEXT</td>
                                        <td>
                                            <span class="constraint default">DEFAULT 'basic'</span>
                                        </td>
                                        <td>User subscription level</td>
                                    </tr>
                                    <tr>
                                        <td class="column-name">created_at</td>
                                        <td class="data-type">TIMESTAMPTZ</td>
                                        <td>
                                            <span class="constraint default">DEFAULT NOW()</span>
                                        </td>
                                        <td>User registration timestamp</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        <!-- Managed Calendars Table -->
                        <div class="table-card">
                            <div class="table-header">
                                <span>managed_calendars</span>
                                <span class="table-type">Existing Table</span>
                            </div>
                            <div class="table-description">
                                Tracks which calendars users have access to manage. Important for logging context.
                            </div>
                            <table>
                                <thead>
                                    <tr>
                                        <th>Column</th>
                                        <th>Type</th>
                                        <th>Constraints</th>
                                        <th>Description</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td class="column-name">id</td>
                                        <td class="data-type">UUID</td>
                                        <td>
                                            <span class="constraint primary-key">PRIMARY KEY</span>
                                        </td>
                                        <td>Unique record identifier</td>
                                    </tr>
                                    <tr>
                                        <td class="column-name">user_id</td>
                                        <td class="data-type">TEXT</td>
                                        <td>
                                            <span class="constraint foreign-key">FK â†’ users.id</span>
                                        </td>
                                        <td>User who manages this calendar</td>
                                    </tr>
                                    <tr>
                                        <td class="column-name">calendar_id</td>
                                        <td class="data-type">TEXT</td>
                                        <td></td>
                                        <td>Google Calendar ID</td>
                                    </tr>
                                    <tr>
                                        <td class="column-name">calendar_name</td>
                                        <td class="data-type">TEXT</td>
                                        <td></td>
                                        <td>Display name of calendar</td>
                                    </tr>
                                    <tr>
                                        <td class="column-name">is_primary</td>
                                        <td class="data-type">BOOLEAN</td>
                                        <td>
                                            <span class="constraint default">DEFAULT false</span>
                                        </td>
                                        <td>Whether this is the user's primary calendar</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Migration Scripts -->
            <div class="section">
                <h2>
                    <span>ðŸš€</span>
                    Migration Scripts
                </h2>

                <div class="migration-code">
                    <span class="sql-comment">-- Migration: 001_create_logging_tables.sql</span><br>
                    <span class="sql-comment">-- Description: Create comprehensive logging tables for user action tracking</span><br><br>

                    <span class="sql-comment">-- 1. Create user_sessions table</span><br>
                    <span class="sql-keyword">CREATE TABLE</span> <span class="sql-type">user_sessions</span> (<br>
                    &nbsp;&nbsp;id <span class="sql-type">TEXT</span> <span class="sql-keyword">PRIMARY KEY</span>,<br>
                    &nbsp;&nbsp;user_id <span class="sql-type">TEXT</span> <span class="sql-keyword">NOT NULL REFERENCES</span> users(id),<br>
                    &nbsp;&nbsp;started_at <span class="sql-type">TIMESTAMPTZ</span> <span class="sql-keyword">DEFAULT</span> NOW(),<br>
                    &nbsp;&nbsp;ended_at <span class="sql-type">TIMESTAMPTZ</span>,<br>
                    &nbsp;&nbsp;total_actions <span class="sql-type">INTEGER</span> <span class="sql-keyword">DEFAULT</span> 0,<br>
                    &nbsp;&nbsp;total_time_saved_minutes <span class="sql-type">INTEGER</span> <span class="sql-keyword">DEFAULT</span> 0,<br>
                    &nbsp;&nbsp;ip_hash <span class="sql-type">TEXT</span>,<br>
                    &nbsp;&nbsp;user_agent <span class="sql-type">TEXT</span>,<br>
                    &nbsp;&nbsp;metadata <span class="sql-type">JSONB</span><br>
                    );<br><br>

                    <span class="sql-comment">-- 2. Create action_types reference table</span><br>
                    <span class="sql-keyword">CREATE TABLE</span> <span class="sql-type">action_types</span> (<br>
                    &nbsp;&nbsp;id <span class="sql-type">UUID</span> <span class="sql-keyword">DEFAULT</span> gen_random_uuid() <span class="sql-keyword">PRIMARY KEY</span>,<br>
                    &nbsp;&nbsp;category <span class="sql-type">TEXT</span> <span class="sql-keyword">NOT NULL</span>,<br>
                    &nbsp;&nbsp;action_type <span class="sql-type">TEXT</span> <span class="sql-keyword">NOT NULL UNIQUE</span>,<br>
                    &nbsp;&nbsp;description <span class="sql-type">TEXT</span>,<br>
                    &nbsp;&nbsp;expected_duration_ms <span class="sql-type">INTEGER</span>,<br>
                    &nbsp;&nbsp;time_saved_minutes <span class="sql-type">INTEGER</span>,<br>
                    &nbsp;&nbsp;created_at <span class="sql-type">TIMESTAMPTZ</span> <span class="sql-keyword">DEFAULT</span> NOW(),<br>
                    &nbsp;&nbsp;<span class="sql-keyword">UNIQUE</span>(category, action_type)<br>
                    );<br><br>

                    <span class="sql-comment">-- 3. Enhanced user_actions table</span><br>
                    <span class="sql-keyword">ALTER TABLE</span> user_actions<br>
                    &nbsp;&nbsp;<span class="sql-keyword">ADD COLUMN</span> action_category <span class="sql-type">TEXT</span>,<br>
                    &nbsp;&nbsp;<span class="sql-keyword">ADD COLUMN</span> action_status <span class="sql-type">TEXT</span> <span class="sql-keyword">DEFAULT</span> <span class="sql-string">'initiated'</span>,<br>
                    &nbsp;&nbsp;<span class="sql-keyword">ADD COLUMN</span> target_calendar_id <span class="sql-type">TEXT</span>,<br>
                    &nbsp;&nbsp;<span class="sql-keyword">ADD COLUMN</span> workflow_id <span class="sql-type">TEXT</span>,<br>
                    &nbsp;&nbsp;<span class="sql-keyword">ADD COLUMN</span> session_id <span class="sql-type">TEXT</span> <span class="sql-keyword">REFERENCES</span> user_sessions(id),<br>
                    &nbsp;&nbsp;<span class="sql-keyword">ADD COLUMN</span> events_affected <span class="sql-type">INTEGER</span> <span class="sql-keyword">DEFAULT</span> 0,<br>
                    &nbsp;&nbsp;<span class="sql-keyword">ADD COLUMN</span> duration_ms <span class="sql-type">INTEGER</span>,<br>
                    &nbsp;&nbsp;<span class="sql-keyword">ADD COLUMN</span> error_code <span class="sql-type">TEXT</span>,<br>
                    &nbsp;&nbsp;<span class="sql-keyword">ADD COLUMN</span> error_message <span class="sql-type">TEXT</span>,<br>
                    &nbsp;&nbsp;<span class="sql-keyword">ADD COLUMN</span> retry_count <span class="sql-type">INTEGER</span> <span class="sql-keyword">DEFAULT</span> 0,<br>
                    &nbsp;&nbsp;<span class="sql-keyword">ADD COLUMN</span> request_params <span class="sql-type">JSONB</span>,<br>
                    &nbsp;&nbsp;<span class="sql-keyword">ADD COLUMN</span> response_data <span class="sql-type">JSONB</span>,<br>
                    &nbsp;&nbsp;<span class="sql-keyword">ADD COLUMN</span> user_agent <span class="sql-type">TEXT</span>,<br>
                    &nbsp;&nbsp;<span class="sql-keyword">ADD COLUMN</span> ip_hash <span class="sql-type">TEXT</span>,<br>
                    &nbsp;&nbsp;<span class="sql-keyword">ADD COLUMN</span> completed_at <span class="sql-type">TIMESTAMPTZ</span>;<br><br>

                    <span class="sql-comment">-- 4. Create action_errors table</span><br>
                    <span class="sql-keyword">CREATE TABLE</span> <span class="sql-type">action_errors</span> (<br>
                    &nbsp;&nbsp;id <span class="sql-type">UUID</span> <span class="sql-keyword">DEFAULT</span> gen_random_uuid() <span class="sql-keyword">PRIMARY KEY</span>,<br>
                    &nbsp;&nbsp;action_id <span class="sql-type">UUID</span> <span class="sql-keyword">REFERENCES</span> user_actions(id),<br>
                    &nbsp;&nbsp;error_type <span class="sql-type">TEXT</span> <span class="sql-keyword">NOT NULL</span>,<br>
                    &nbsp;&nbsp;error_code <span class="sql-type">TEXT</span> <span class="sql-keyword">NOT NULL</span>,<br>
                    &nbsp;&nbsp;error_message <span class="sql-type">TEXT</span>,<br>
                    &nbsp;&nbsp;stack_trace <span class="sql-type">TEXT</span>,<br>
                    &nbsp;&nbsp;context <span class="sql-type">JSONB</span>,<br>
                    &nbsp;&nbsp;created_at <span class="sql-type">TIMESTAMPTZ</span> <span class="sql-keyword">DEFAULT</span> NOW()<br>
                    );<br><br>

                    <span class="sql-comment">-- 5. Create indexes for performance</span><br>
                    <span class="sql-keyword">CREATE INDEX</span> idx_user_actions_user_id <span class="sql-keyword">ON</span> user_actions(user_id);<br>
                    <span class="sql-keyword">CREATE INDEX</span> idx_user_actions_calendar_id <span class="sql-keyword">ON</span> user_actions(calendar_id);<br>
                    <span class="sql-keyword">CREATE INDEX</span> idx_user_actions_action_type <span class="sql-keyword">ON</span> user_actions(action_type);<br>
                    <span class="sql-keyword">CREATE INDEX</span> idx_user_actions_created_at <span class="sql-keyword">ON</span> user_actions(created_at);<br>
                    <span class="sql-keyword">CREATE INDEX</span> idx_user_actions_session_id <span class="sql-keyword">ON</span> user_actions(session_id);<br>
                    <span class="sql-keyword">CREATE INDEX</span> idx_user_actions_status <span class="sql-keyword">ON</span> user_actions(action_status);<br>
                    <span class="sql-keyword">CREATE INDEX</span> idx_user_sessions_user_id <span class="sql-keyword">ON</span> user_sessions(user_id);<br>
                    <span class="sql-keyword">CREATE INDEX</span> idx_user_sessions_started_at <span class="sql-keyword">ON</span> user_sessions(started_at);<br>
                    <span class="sql-keyword">CREATE INDEX</span> idx_action_errors_action_id <span class="sql-keyword">ON</span> action_errors(action_id);<br>
                    <span class="sql-keyword">CREATE INDEX</span> idx_action_errors_error_type <span class="sql-keyword">ON</span> action_errors(error_type);<br>
                    <span class="sql-keyword">CREATE INDEX</span> idx_action_errors_created_at <span class="sql-keyword">ON</span> action_errors(created_at);<br><br>

                    <span class="sql-comment">-- 6. Enable Row Level Security</span><br>
                    <span class="sql-keyword">ALTER TABLE</span> user_sessions <span class="sql-keyword">ENABLE ROW LEVEL SECURITY</span>;<br>
                    <span class="sql-keyword">ALTER TABLE</span> action_types <span class="sql-keyword">ENABLE ROW LEVEL SECURITY</span>;<br>
                    <span class="sql-keyword">ALTER TABLE</span> action_errors <span class="sql-keyword">ENABLE ROW LEVEL SECURITY</span>;<br><br>

                    <span class="sql-comment">-- 7. Create RLS policies</span><br>
                    <span class="sql-keyword">CREATE POLICY</span> <span class="sql-string">"Users can view own sessions"</span> <span class="sql-keyword">ON</span> user_sessions<br>
                    &nbsp;&nbsp;<span class="sql-keyword">FOR SELECT USING</span> (auth.uid()::text = user_id);<br><br>

                    <span class="sql-keyword">CREATE POLICY</span> <span class="sql-string">"Users can view own actions"</span> <span class="sql-keyword">ON</span> user_actions<br>
                    &nbsp;&nbsp;<span class="sql-keyword">FOR SELECT USING</span> (auth.uid()::text = user_id);<br><br>

                    <span class="sql-keyword">CREATE POLICY</span> <span class="sql-string">"Users can insert own actions"</span> <span class="sql-keyword">ON</span> user_actions<br>
                    &nbsp;&nbsp;<span class="sql-keyword">FOR INSERT WITH CHECK</span> (auth.uid()::text = user_id);<br><br>

                    <span class="sql-keyword">CREATE POLICY</span> <span class="sql-string">"Public can view action types"</span> <span class="sql-keyword">ON</span> action_types<br>
                    &nbsp;&nbsp;<span class="sql-keyword">FOR SELECT USING</span> (true);
                </div>
            </div>

            <!-- Relationships -->
            <div class="section">
                <h2>
                    <span>ðŸ”—</span>
                    Table Relationships
                </h2>

                <div class="relationships">
                    <div class="relationship-card">
                        <div class="relationship-title">users â†’ user_sessions</div>
                        <div class="relationship-detail">
                            One-to-Many: A user can have multiple sessions
                        </div>
                    </div>

                    <div class="relationship-card">
                        <div class="relationship-title">users â†’ user_actions</div>
                        <div class="relationship-detail">
                            One-to-Many: A user can perform many actions
                        </div>
                    </div>

                    <div class="relationship-card">
                        <div class="relationship-title">user_sessions â†’ user_actions</div>
                        <div class="relationship-detail">
                            One-to-Many: A session contains multiple actions
                        </div>
                    </div>

                    <div class="relationship-card">
                        <div class="relationship-title">user_actions â†’ action_errors</div>
                        <div class="relationship-detail">
                            One-to-Many: An action can have multiple error records
                        </div>
                    </div>

                    <div class="relationship-card">
                        <div class="relationship-title">users â†’ managed_calendars</div>
                        <div class="relationship-detail">
                            One-to-Many: A user can manage multiple calendars
                        </div>
                    </div>

                    <div class="relationship-card">
                        <div class="relationship-title">action_types â†” user_actions</div>
                        <div class="relationship-detail">
                            Reference: Actions reference predefined types (no FK)
                        </div>
                    </div>
                </div>
            </div>

            <!-- Privacy & Security -->
            <div class="section">
                <h2>
                    <span>ðŸ”’</span>
                    Privacy & Security Features
                </h2>

                <div class="schema-diagram">
                    <h3>Data Protection Measures</h3>
                    <ul style="list-style: none; padding: 0;">
                        <li style="margin: 10px 0;">âœ… <strong>No PII Storage:</strong> Only IDs are stored (user_id, calendar_id, event_id)</li>
                        <li style="margin: 10px 0;">âœ… <strong>IP Hashing:</strong> IP addresses are hashed for geographic analytics without storing actual IPs</li>
                        <li style="margin: 10px 0;">âœ… <strong>Sanitized Errors:</strong> Error messages are sanitized to remove emails, names, and other PII</li>
                        <li style="margin: 10px 0;">âœ… <strong>Row Level Security:</strong> Users can only access their own data</li>
                        <li style="margin: 10px 0;">âœ… <strong>JSONB Filtering:</strong> Metadata fields are sanitized to exclude PII fields</li>
                        <li style="margin: 10px 0;">âœ… <strong>90-Day Retention:</strong> Automatic cleanup of logs older than 90 days</li>
                        <li style="margin: 10px 0;">âœ… <strong>GDPR Compliant:</strong> Data export and deletion capabilities</li>
                    </ul>
                </div>
            </div>

            <!-- Performance Considerations -->
            <div class="section">
                <h2>
                    <span>âš¡</span>
                    Performance Optimizations
                </h2>

                <div class="schema-diagram">
                    <h3>Database Performance Features</h3>
                    <ul style="list-style: none; padding: 0;">
                        <li style="margin: 10px 0;">ðŸš€ <strong>Comprehensive Indexing:</strong> All foreign keys and frequently queried columns are indexed</li>
                        <li style="margin: 10px 0;">ðŸš€ <strong>JSONB Fields:</strong> Flexible metadata storage with native PostgreSQL optimization</li>
                        <li style="margin: 10px 0;">ðŸš€ <strong>Batch Inserts:</strong> Actions are batched and sent every 1 second to reduce database calls</li>
                        <li style="margin: 10px 0;">ðŸš€ <strong>Async Logging:</strong> Non-blocking logging with < 50ms latency impact</li>
                        <li style="margin: 10px 0;">ðŸš€ <strong>Partition Ready:</strong> Table structure supports future partitioning by created_at</li>
                        <li style="margin: 10px 0;">ðŸš€ <strong>Aggregate Tables:</strong> time_savings_summary for pre-computed analytics</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script>
        function showTab(tabName) {
            // Remove active class from all tabs and contents
            const tabs = document.querySelectorAll('.tab');
            const contents = document.querySelectorAll('.tab-content');

            tabs.forEach(tab => tab.classList.remove('active'));
            contents.forEach(content => content.classList.remove('active'));

            // Add active class to selected tab and content
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');
        }
    </script>
</body>
</html>