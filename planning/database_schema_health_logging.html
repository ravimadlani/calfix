<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calfix Health Score & Logging Database Schema</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 40px 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        header {
            background: linear-gradient(135deg, #5f72be 0%, #9921e8 100%);
            padding: 40px;
            text-align: center;
            color: white;
        }

        h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
        }

        .subtitle {
            font-size: 1.2em;
            opacity: 0.95;
        }

        .content {
            padding: 40px;
        }

        .section {
            margin-bottom: 50px;
        }

        h2 {
            color: #333;
            font-size: 1.8em;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #667eea;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .icon {
            width: 30px;
            height: 30px;
        }

        .schema-diagram {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 10px;
            margin: 20px 0;
            overflow-x: auto;
        }

        .table-card {
            background: white;
            border: 2px solid #e1e4e8;
            border-radius: 10px;
            margin-bottom: 30px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .table-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .table-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 15px 20px;
            color: white;
            font-weight: bold;
            font-size: 1.2em;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .table-header.health {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }

        .table-type {
            background: rgba(255, 255, 255, 0.2);
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 0.8em;
            text-transform: uppercase;
        }

        .table-description {
            padding: 15px 20px;
            background: #f8f9fa;
            border-bottom: 1px solid #e1e4e8;
            color: #586069;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th {
            background: #f1f3f5;
            padding: 12px 15px;
            text-align: left;
            font-weight: 600;
            color: #333;
            font-size: 0.9em;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        td {
            padding: 12px 15px;
            border-bottom: 1px solid #e1e4e8;
            color: #333;
        }

        tr:last-child td {
            border-bottom: none;
        }

        tr:hover {
            background: #f8f9fa;
        }

        .column-name {
            font-weight: 600;
            color: #0366d6;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 0.95em;
        }

        .data-type {
            color: #6f42c1;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 0.9em;
            background: #f6f8fa;
            padding: 2px 6px;
            border-radius: 3px;
        }

        .constraint {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.85em;
            margin: 0 2px;
            font-weight: 500;
        }

        .primary-key {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffc107;
        }

        .foreign-key {
            background: #cfe2ff;
            color: #084298;
            border: 1px solid #6ea8fe;
        }

        .not-null {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .unique {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #9ec5ce;
        }

        .index {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .default {
            background: #e2e3e5;
            color: #383d41;
            border: 1px solid #d6d8db;
        }

        .check {
            background: #fff5ec;
            color: #8a3800;
            border: 1px solid #ffb386;
        }

        .generated {
            background: #f0e6ff;
            color: #5a248e;
            border: 1px solid #d4b5ff;
        }

        .er-diagram {
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            margin: 30px 0;
        }

        svg {
            max-width: 100%;
            height: auto;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 25px;
            border-radius: 10px;
            color: white;
            text-align: center;
        }

        .stat-card.health {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }

        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 1em;
            opacity: 0.9;
        }

        .migration-code {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 0.9em;
            line-height: 1.6;
            margin: 20px 0;
        }

        .sql-keyword {
            color: #66d9ef;
            font-weight: bold;
        }

        .sql-type {
            color: #a6e22e;
        }

        .sql-string {
            color: #e6db74;
        }

        .sql-comment {
            color: #75715e;
            font-style: italic;
        }

        .relationships {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .relationship-card {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .relationship-card.health {
            border-left-color: #10b981;
        }

        .relationship-title {
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }

        .relationship-detail {
            color: #586069;
            font-size: 0.9em;
        }

        .tab-container {
            margin: 30px 0;
        }

        .tabs {
            display: flex;
            gap: 2px;
            background: #f1f3f5;
            padding: 2px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .tab {
            padding: 10px 20px;
            background: transparent;
            border: none;
            cursor: pointer;
            border-radius: 6px;
            font-size: 1em;
            transition: all 0.3s;
        }

        .tab.active {
            background: white;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            color: #667eea;
            font-weight: 600;
        }

        .tab:hover:not(.active) {
            background: rgba(255, 255, 255, 0.5);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.85em;
            font-weight: 500;
            margin-left: 5px;
        }

        .badge-new {
            background: #28a745;
            color: white;
        }

        .badge-health {
            background: #10b981;
            color: white;
        }

        .badge-enhanced {
            background: #ffc107;
            color: #333;
        }

        .badge-existing {
            background: #6c757d;
            color: white;
        }

        .health-flag-table {
            background: white;
            border-radius: 8px;
            overflow: hidden;
            margin: 20px 0;
        }

        .health-flag-table th {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
        }

        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }

            h1 {
                font-size: 1.8em;
            }

            .content {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ðŸ“Š Calfix Health Score & Logging Database Schema</h1>
            <div class="subtitle">Comprehensive User Action Tracking with Calendar Health Monitoring</div>
        </header>

        <div class="content">
            <!-- Overview Section -->
            <div class="section">
                <h2>
                    <span>ðŸ“ˆ</span>
                    Schema Overview
                </h2>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number">14</div>
                        <div class="stat-label">Total Tables</div>
                    </div>
                    <div class="stat-card health">
                        <div class="stat-number">3</div>
                        <div class="stat-label">Health Score Tables</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">80+</div>
                        <div class="stat-label">Action Types</div>
                    </div>
                    <div class="stat-card health">
                        <div class="stat-number">15</div>
                        <div class="stat-label">Health Score Factors</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">6</div>
                        <div class="stat-label">Time Horizons</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">0</div>
                        <div class="stat-label">PII Fields Stored</div>
                    </div>
                </div>
            </div>

            <!-- Health Score Factors -->
            <div class="section">
                <h2>
                    <span>ðŸ’š</span>
                    Health Score Factors & Impact
                </h2>

                <div class="schema-diagram">
                    <table class="health-flag-table">
                        <thead>
                            <tr>
                                <th>Flag Type</th>
                                <th>Health Impact</th>
                                <th>Description</th>
                                <th>Resolution Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>Back-to-back meetings</strong></td>
                                <td style="color: #dc2626;">-15 points</td>
                                <td>No buffer between meetings</td>
                                <td>Add buffer blocks</td>
                            </tr>
                            <tr>
                                <td><strong>Insufficient buffer</strong></td>
                                <td style="color: #ea580c;">-8 points</td>
                                <td>Less than 10 min between meetings</td>
                                <td>Extend buffers</td>
                            </tr>
                            <tr>
                                <td><strong>Focus block available</strong></td>
                                <td style="color: #16a34a;">+8 points</td>
                                <td>60-120 min deep work time</td>
                                <td>Maintain blocks</td>
                            </tr>
                            <tr>
                                <td><strong>Meeting overload (6+ hrs)</strong></td>
                                <td style="color: #dc2626;">-10 points</td>
                                <td>Too many meetings in day</td>
                                <td>Decline non-essential</td>
                            </tr>
                            <tr>
                                <td><strong>Meeting overload (8+ hrs)</strong></td>
                                <td style="color: #991b1b;">-20 points</td>
                                <td>Extreme meeting load (cumulative)</td>
                                <td>Urgent reschedule</td>
                            </tr>
                            <tr>
                                <td><strong>Out-of-hours meetings</strong></td>
                                <td style="color: #dc2626;">-12 points</td>
                                <td>Meetings outside business hours</td>
                                <td>Reschedule to work hours</td>
                            </tr>
                            <tr>
                                <td><strong>Double bookings</strong></td>
                                <td style="color: #991b1b;">-25 points</td>
                                <td>Overlapping meetings</td>
                                <td>Resolve conflicts</td>
                            </tr>
                            <tr>
                                <td><strong>Missing video links</strong></td>
                                <td style="color: #f59e0b;">-3 points</td>
                                <td>Meetings without conference links</td>
                                <td>Add video links</td>
                            </tr>
                            <tr>
                                <td><strong>Declined meetings present</strong></td>
                                <td style="color: #ea580c;">-5 points</td>
                                <td>Declined meetings not removed</td>
                                <td>Delete declined</td>
                            </tr>
                            <tr>
                                <td><strong>International flight no location</strong></td>
                                <td style="color: #dc2626;">-10 points</td>
                                <td>Missing timezone context</td>
                                <td>Add location events</td>
                            </tr>
                            <tr>
                                <td><strong>Flight without travel blocks</strong></td>
                                <td style="color: #ea580c;">-8 points</td>
                                <td>No buffer for airport time</td>
                                <td>Add travel blocks</td>
                            </tr>
                            <tr>
                                <td><strong>No lunch break</strong></td>
                                <td style="color: #dc2626;">-15 points</td>
                                <td>No break scheduled for lunch</td>
                                <td>Block lunch time</td>
                            </tr>
                            <tr>
                                <td><strong>Late night meetings</strong></td>
                                <td style="color: #991b1b;">-20 points</td>
                                <td>Meetings after 8 PM local</td>
                                <td>Move to business hours</td>
                            </tr>
                            <tr>
                                <td><strong>Early morning meetings</strong></td>
                                <td style="color: #dc2626;">-15 points</td>
                                <td>Meetings before 8 AM local</td>
                                <td>Reschedule later</td>
                            </tr>
                            <tr>
                                <td><strong>Fragmented schedule</strong></td>
                                <td style="color: #dc2626;">-10 points</td>
                                <td>Too many context switches</td>
                                <td>Group similar meetings</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="schema-diagram" style="margin-top: 20px;">
                    <h3>Time Horizons for Health Score Tracking</h3>
                    <div class="stats-grid" style="margin-top: 15px;">
                        <div style="background: #f0fdf4; padding: 15px; border-radius: 8px; border: 2px solid #86efac;">
                            <strong>Today</strong><br>
                            <small>Current day's calendar health</small>
                        </div>
                        <div style="background: #f0fdf4; padding: 15px; border-radius: 8px; border: 2px solid #86efac;">
                            <strong>Tomorrow</strong><br>
                            <small>Next day's calendar health</small>
                        </div>
                        <div style="background: #eff6ff; padding: 15px; border-radius: 8px; border: 2px solid #93c5fd;">
                            <strong>This Week</strong><br>
                            <small>Current week aggregate</small>
                        </div>
                        <div style="background: #eff6ff; padding: 15px; border-radius: 8px; border: 2px solid #93c5fd;">
                            <strong>Next Week</strong><br>
                            <small>Following week aggregate</small>
                        </div>
                        <div style="background: #faf5ff; padding: 15px; border-radius: 8px; border: 2px solid #d8b4fe;">
                            <strong>This Month</strong><br>
                            <small>Current month aggregate</small>
                        </div>
                        <div style="background: #faf5ff; padding: 15px; border-radius: 8px; border: 2px solid #d8b4fe;">
                            <strong>Next Month</strong><br>
                            <small>Following month aggregate</small>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Entity Relationship Diagram -->
            <div class="section">
                <h2>
                    <span>ðŸ”—</span>
                    Entity Relationship Diagram
                </h2>

                <div class="er-diagram">
                    <svg viewBox="0 0 1400 1000" xmlns="http://www.w3.org/2000/svg">
                        <!-- Users table (center) -->
                        <rect x="600" y="50" width="200" height="150" fill="#e8f4fd" stroke="#667eea" stroke-width="2" rx="5"/>
                        <text x="700" y="80" text-anchor="middle" font-weight="bold" font-size="16">users</text>
                        <line x1="610" y1="90" x2="790" y2="90" stroke="#667eea" stroke-width="1"/>
                        <text x="620" y="110" font-size="12">id (PK)</text>
                        <text x="620" y="130" font-size="12">email</text>
                        <text x="620" y="150" font-size="12">subscription_tier</text>
                        <text x="620" y="170" font-size="12">created_at</text>

                        <!-- User Actions table (Enhanced) -->
                        <rect x="300" y="300" width="220" height="200" fill="#fff3cd" stroke="#ffc107" stroke-width="2" rx="5"/>
                        <text x="410" y="330" text-anchor="middle" font-weight="bold" font-size="16">user_actions</text>
                        <text x="410" y="350" text-anchor="middle" font-size="10" fill="#856404">(ENHANCED)</text>
                        <line x1="310" y1="360" x2="510" y2="360" stroke="#ffc107" stroke-width="1"/>
                        <text x="320" y="380" font-size="12">id (PK)</text>
                        <text x="320" y="400" font-size="12">user_id (FK)</text>
                        <text x="320" y="420" font-size="12">action_category</text>
                        <text x="320" y="440" font-size="12">health_impact_score</text>
                        <text x="320" y="460" font-size="12">health_horizons_affected</text>
                        <text x="320" y="480" font-size="12">metadata</text>

                        <!-- Health Scores table (New) -->
                        <rect x="880" y="300" width="220" height="220" fill="#d4edda" stroke="#10b981" stroke-width="3" rx="5"/>
                        <text x="990" y="330" text-anchor="middle" font-weight="bold" font-size="16">health_scores</text>
                        <text x="990" y="350" text-anchor="middle" font-size="10" fill="#047857">(HEALTH TRACKING)</text>
                        <line x1="890" y1="360" x2="1090" y2="360" stroke="#10b981" stroke-width="1"/>
                        <text x="900" y="380" font-size="12">id (PK)</text>
                        <text x="900" y="400" font-size="12">user_id (FK)</text>
                        <text x="900" y="420" font-size="12">calendar_id</text>
                        <text x="900" y="440" font-size="12">time_horizon</text>
                        <text x="900" y="460" font-size="12">health_score</text>
                        <text x="900" y="480" font-size="12">flags (JSONB)</text>
                        <text x="900" y="500" font-size="12">period_start/end</text>

                        <!-- Health Score Sessions table (New) -->
                        <rect x="600" y="600" width="240" height="200" fill="#d4edda" stroke="#10b981" stroke-width="3" rx="5"/>
                        <text x="720" y="630" text-anchor="middle" font-weight="bold" font-size="16">health_score_sessions</text>
                        <text x="720" y="650" text-anchor="middle" font-size="10" fill="#047857">(SESSION TRACKING)</text>
                        <line x1="610" y1="660" x2="830" y2="660" stroke="#10b981" stroke-width="1"/>
                        <text x="620" y="680" font-size="12">id (PK)</text>
                        <text x="620" y="700" font-size="12">session_id (FK)</text>
                        <text x="620" y="720" font-size="12">session_type (start/end)</text>
                        <text x="620" y="740" font-size="12">health_[horizons]</text>
                        <text x="620" y="760" font-size="12">total_health_improvement</text>
                        <text x="620" y="780" font-size="12">time_saved_minutes</text>

                        <!-- Action Health Impacts table (New) -->
                        <rect x="880" y="600" width="220" height="180" fill="#d4edda" stroke="#10b981" stroke-width="3" rx="5"/>
                        <text x="990" y="630" text-anchor="middle" font-weight="bold" font-size="16">action_health_impacts</text>
                        <text x="990" y="650" text-anchor="middle" font-size="10" fill="#047857">(IMPACT TRACKING)</text>
                        <line x1="890" y1="660" x2="1090" y2="660" stroke="#10b981" stroke-width="1"/>
                        <text x="900" y="680" font-size="12">id (PK)</text>
                        <text x="900" y="700" font-size="12">action_id (FK)</text>
                        <text x="900" y="720" font-size="12">score_before</text>
                        <text x="900" y="740" font-size="12">score_after</text>
                        <text x="900" y="760" font-size="12">score_delta</text>

                        <!-- User Sessions table -->
                        <rect x="50" y="300" width="200" height="140" fill="#e8f4fd" stroke="#667eea" stroke-width="2" rx="5"/>
                        <text x="150" y="330" text-anchor="middle" font-weight="bold" font-size="16">user_sessions</text>
                        <line x1="60" y1="340" x2="240" y2="340" stroke="#667eea" stroke-width="1"/>
                        <text x="70" y="360" font-size="12">id (PK)</text>
                        <text x="70" y="380" font-size="12">user_id (FK)</text>
                        <text x="70" y="400" font-size="12">started_at</text>
                        <text x="70" y="420" font-size="12">total_actions</text>

                        <!-- Action Types table -->
                        <rect x="50" y="500" width="200" height="140" fill="#e8f4fd" stroke="#667eea" stroke-width="2" rx="5"/>
                        <text x="150" y="530" text-anchor="middle" font-weight="bold" font-size="16">action_types</text>
                        <line x1="60" y1="540" x2="240" y2="540" stroke="#667eea" stroke-width="1"/>
                        <text x="70" y="560" font-size="12">id (PK)</text>
                        <text x="70" y="580" font-size="12">category</text>
                        <text x="70" y="600" font-size="12">action_type</text>
                        <text x="70" y="620" font-size="12">time_saved_minutes</text>

                        <!-- Action Errors table -->
                        <rect x="300" y="600" width="200" height="140" fill="#e8f4fd" stroke="#667eea" stroke-width="2" rx="5"/>
                        <text x="400" y="630" text-anchor="middle" font-weight="bold" font-size="16">action_errors</text>
                        <line x1="310" y1="640" x2="490" y2="640" stroke="#667eea" stroke-width="1"/>
                        <text x="320" y="660" font-size="12">id (PK)</text>
                        <text x="320" y="680" font-size="12">action_id (FK)</text>
                        <text x="320" y="700" font-size="12">error_type</text>
                        <text x="320" y="720" font-size="12">error_code</text>

                        <!-- Managed Calendars table -->
                        <rect x="1150" y="400" width="200" height="140" fill="#e8f4fd" stroke="#667eea" stroke-width="2" rx="5"/>
                        <text x="1250" y="430" text-anchor="middle" font-weight="bold" font-size="16">managed_calendars</text>
                        <line x1="1160" y1="440" x2="1340" y2="440" stroke="#667eea" stroke-width="1"/>
                        <text x="1170" y="460" font-size="12">id (PK)</text>
                        <text x="1170" y="480" font-size="12">user_id (FK)</text>
                        <text x="1170" y="500" font-size="12">calendar_id</text>
                        <text x="1170" y="520" font-size="12">calendar_name</text>

                        <!-- Relationships -->
                        <!-- users -> user_actions -->
                        <line x1="600" y1="150" x2="450" y2="300" stroke="#333" stroke-width="1" stroke-dasharray="5,5"/>
                        <polygon points="450,300 455,295 455,305" fill="#333"/>

                        <!-- users -> health_scores -->
                        <line x1="800" y1="150" x2="950" y2="300" stroke="#10b981" stroke-width="2" stroke-dasharray="5,5"/>
                        <polygon points="950,300 945,295 945,305" fill="#10b981"/>

                        <!-- users -> health_score_sessions -->
                        <line x1="700" y1="200" x2="720" y2="600" stroke="#10b981" stroke-width="2" stroke-dasharray="5,5"/>
                        <polygon points="720,600 715,595 725,595" fill="#10b981"/>

                        <!-- user_actions -> action_health_impacts -->
                        <line x1="520" y1="450" x2="880" y2="690" stroke="#10b981" stroke-width="2" stroke-dasharray="5,5"/>
                        <polygon points="880,690 875,685 875,695" fill="#10b981"/>

                        <!-- user_sessions -> user_actions -->
                        <line x1="250" y1="370" x2="300" y2="380" stroke="#333" stroke-width="1" stroke-dasharray="5,5"/>
                        <polygon points="300,380 295,375 295,385" fill="#333"/>

                        <!-- user_sessions -> health_score_sessions -->
                        <line x1="250" y1="400" x2="600" y2="700" stroke="#10b981" stroke-width="2" stroke-dasharray="5,5"/>
                        <polygon points="600,700 595,695 595,705" fill="#10b981"/>

                        <!-- user_actions -> action_errors -->
                        <line x1="410" y1="500" x2="400" y2="600" stroke="#333" stroke-width="1" stroke-dasharray="5,5"/>
                        <polygon points="400,600 395,595 405,595" fill="#333"/>

                        <!-- users -> managed_calendars -->
                        <line x1="800" y1="125" x2="1150" y2="470" stroke="#333" stroke-width="1" stroke-dasharray="5,5"/>
                        <polygon points="1150,470 1145,465 1145,475" fill="#333"/>

                        <!-- Legend -->
                        <rect x="1150" y="800" width="220" height="180" fill="#f8f9fa" stroke="#dee2e6" stroke-width="1" rx="5"/>
                        <text x="1260" y="825" text-anchor="middle" font-weight="bold" font-size="14">Legend</text>
                        <rect x="1160" y="840" width="30" height="20" fill="#d4edda" stroke="#10b981" stroke-width="3"/>
                        <text x="1200" y="855" font-size="12">Health Score Table</text>
                        <rect x="1160" y="870" width="30" height="20" fill="#d4edda" stroke="#28a745" stroke-width="2"/>
                        <text x="1200" y="885" font-size="12">New Table</text>
                        <rect x="1160" y="900" width="30" height="20" fill="#fff3cd" stroke="#ffc107" stroke-width="2"/>
                        <text x="1200" y="915" font-size="12">Enhanced Table</text>
                        <rect x="1160" y="930" width="30" height="20" fill="#e8f4fd" stroke="#667eea" stroke-width="2"/>
                        <text x="1200" y="945" font-size="12">Existing Table</text>
                    </svg>
                </div>
            </div>

            <!-- Detailed Schema Tables -->
            <div class="section">
                <h2>
                    <span>ðŸ“‹</span>
                    Detailed Table Schemas
                </h2>

                <div class="tab-container">
                    <div class="tabs">
                        <button class="tab active" onclick="showTab('health')">Health Score Tables</button>
                        <button class="tab" onclick="showTab('logging')">Logging Tables</button>
                        <button class="tab" onclick="showTab('existing')">Related Tables</button>
                    </div>

                    <!-- Health Score Tables -->
                    <div id="health" class="tab-content active">
                        <!-- Health Scores Table -->
                        <div class="table-card">
                            <div class="table-header health">
                                <span>health_scores</span>
                                <span class="table-type">Health Tracking</span>
                            </div>
                            <div class="table-description">
                                Tracks calendar health scores across multiple time horizons (today, tomorrow, this week, next week, this month, next month). Each record represents a health score calculation at a specific point in time.
                            </div>
                            <table>
                                <thead>
                                    <tr>
                                        <th>Column</th>
                                        <th>Type</th>
                                        <th>Constraints</th>
                                        <th>Description</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td class="column-name">id</td>
                                        <td class="data-type">UUID</td>
                                        <td>
                                            <span class="constraint primary-key">PRIMARY KEY</span>
                                            <span class="constraint default">DEFAULT gen_random_uuid()</span>
                                        </td>
                                        <td>Unique identifier</td>
                                    </tr>
                                    <tr>
                                        <td class="column-name">user_id</td>
                                        <td class="data-type">TEXT</td>
                                        <td>
                                            <span class="constraint not-null">NOT NULL</span>
                                            <span class="constraint foreign-key">FK â†’ users.id</span>
                                            <span class="constraint index">INDEXED</span>
                                        </td>
                                        <td>User who owns this score</td>
                                    </tr>
                                    <tr>
                                        <td class="column-name">calendar_id</td>
                                        <td class="data-type">TEXT</td>
                                        <td>
                                            <span class="constraint not-null">NOT NULL</span>
                                            <span class="constraint index">INDEXED</span>
                                        </td>
                                        <td>Calendar being assessed</td>
                                    </tr>
                                    <tr>
                                        <td class="column-name">calculation_time</td>
                                        <td class="data-type">TIMESTAMPTZ</td>
                                        <td>
                                            <span class="constraint not-null">NOT NULL</span>
                                            <span class="constraint default">DEFAULT NOW()</span>
                                            <span class="constraint index">INDEXED</span>
                                        </td>
                                        <td>When score was calculated</td>
                                    </tr>
                                    <tr>
                                        <td class="column-name">time_horizon</td>
                                        <td class="data-type">TEXT</td>
                                        <td>
                                            <span class="constraint not-null">NOT NULL</span>
                                            <span class="constraint index">INDEXED</span>
                                        </td>
                                        <td>Period: today, tomorrow, this_week, next_week, this_month, next_month</td>
                                    </tr>
                                    <tr>
                                        <td class="column-name">period_start</td>
                                        <td class="data-type">DATE</td>
                                        <td>
                                            <span class="constraint not-null">NOT NULL</span>
                                            <span class="constraint index">INDEXED</span>
                                        </td>
                                        <td>Start of period being assessed</td>
                                    </tr>
                                    <tr>
                                        <td class="column-name">period_end</td>
                                        <td class="data-type">DATE</td>
                                        <td>
                                            <span class="constraint not-null">NOT NULL</span>
                                        </td>
                                        <td>End of period being assessed</td>
                                    </tr>
                                    <tr>
                                        <td class="column-name">health_score</td>
                                        <td class="data-type">INTEGER</td>
                                        <td>
                                            <span class="constraint not-null">NOT NULL</span>
                                            <span class="constraint check">CHECK (0-100)</span>
                                        </td>
                                        <td>Calculated health score (0-100)</td>
                                    </tr>
                                    <tr>
                                        <td class="column-name">previous_score</td>
                                        <td class="data-type">INTEGER</td>
                                        <td></td>
                                        <td>Previous score for comparison</td>
                                    </tr>
                                    <tr>
                                        <td class="column-name">score_change</td>
                                        <td class="data-type">INTEGER</td>
                                        <td>
                                            <span class="constraint generated">GENERATED</span>
                                        </td>
                                        <td>Computed: health_score - previous_score</td>
                                    </tr>
                                    <tr>
                                        <td class="column-name">back_to_back_count</td>
                                        <td class="data-type">INTEGER</td>
                                        <td>
                                            <span class="constraint default">DEFAULT 0</span>
                                        </td>
                                        <td>Number of back-to-back meetings</td>
                                    </tr>
                                    <tr>
                                        <td class="column-name">insufficient_buffer_count</td>
                                        <td class="data-type">INTEGER</td>
                                        <td>
                                            <span class="constraint default">DEFAULT 0</span>
                                        </td>
                                        <td>Meetings with < 10 min buffer</td>
                                    </tr>
                                    <tr>
                                        <td class="column-name">focus_block_count</td>
                                        <td class="data-type">INTEGER</td>
                                        <td>
                                            <span class="constraint default">DEFAULT 0</span>
                                        </td>
                                        <td>Available deep work blocks</td>
                                    </tr>
                                    <tr>
                                        <td class="column-name">double_booking_count</td>
                                        <td class="data-type">INTEGER</td>
                                        <td>
                                            <span class="constraint default">DEFAULT 0</span>
                                        </td>
                                        <td>Overlapping meetings</td>
                                    </tr>
                                    <tr>
                                        <td class="column-name">out_of_hours_count</td>
                                        <td class="data-type">INTEGER</td>
                                        <td>
                                            <span class="constraint default">DEFAULT 0</span>
                                        </td>
                                        <td>Meetings outside business hours</td>
                                    </tr>
                                    <tr>
                                        <td class="column-name">meeting_hours</td>
                                        <td class="data-type">DECIMAL(5,2)</td>
                                        <td>
                                            <span class="constraint default">DEFAULT 0</span>
                                        </td>
                                        <td>Total hours in meetings</td>
                                    </tr>
                                    <tr>
                                        <td class="column-name">flags</td>
                                        <td class="data-type">JSONB</td>
                                        <td></td>
                                        <td>Detailed flag information</td>
                                    </tr>
                                    <tr>
                                        <td class="column-name">recommendations</td>
                                        <td class="data-type">JSONB</td>
                                        <td></td>
                                        <td>AI-generated recommendations</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        <!-- Health Score Sessions Table -->
                        <div class="table-card">
                            <div class="table-header health">
                                <span>health_score_sessions</span>
                                <span class="table-type">Session Tracking</span>
                            </div>
                            <div class="table-description">
                                Captures health scores at the start and end of each user session. Tracks improvements made during the session across all time horizons.
                            </div>
                            <table>
                                <thead>
                                    <tr>
                                        <th>Column</th>
                                        <th>Type</th>
                                        <th>Constraints</th>
                                        <th>Description</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td class="column-name">id</td>
                                        <td class="data-type">UUID</td>
                                        <td>
                                            <span class="constraint primary-key">PRIMARY KEY</span>
                                            <span class="constraint default">DEFAULT gen_random_uuid()</span>
                                        </td>
                                        <td>Unique identifier</td>
                                    </tr>
                                    <tr>
                                        <td class="column-name">session_id</td>
                                        <td class="data-type">TEXT</td>
                                        <td>
                                            <span class="constraint not-null">NOT NULL</span>
                                            <span class="constraint foreign-key">FK â†’ user_sessions.id</span>
                                            <span class="constraint index">INDEXED</span>
                                        </td>
                                        <td>Reference to user session</td>
                                    </tr>
                                    <tr>
                                        <td class="column-name">user_id</td>
                                        <td class="data-type">TEXT</td>
                                        <td>
                                            <span class="constraint not-null">NOT NULL</span>
                                            <span class="constraint foreign-key">FK â†’ users.id</span>
                                            <span class="constraint index">INDEXED</span>
                                        </td>
                                        <td>User reference</td>
                                    </tr>
                                    <tr>
                                        <td class="column-name">calendar_id</td>
                                        <td class="data-type">TEXT</td>
                                        <td>
                                            <span class="constraint not-null">NOT NULL</span>
                                        </td>
                                        <td>Calendar being managed</td>
                                    </tr>
                                    <tr>
                                        <td class="column-name">session_type</td>
                                        <td class="data-type">TEXT</td>
                                        <td>
                                            <span class="constraint not-null">NOT NULL</span>
                                            <span class="constraint check">CHECK IN ('start','end')</span>
                                        </td>
                                        <td>Session boundary: start or end</td>
                                    </tr>
                                    <tr>
                                        <td class="column-name">recorded_at</td>
                                        <td class="data-type">TIMESTAMPTZ</td>
                                        <td>
                                            <span class="constraint not-null">NOT NULL</span>
                                            <span class="constraint default">DEFAULT NOW()</span>
                                            <span class="constraint index">INDEXED</span>
                                        </td>
                                        <td>When snapshot was taken</td>
                                    </tr>
                                    <tr>
                                        <td class="column-name">health_today</td>
                                        <td class="data-type">INTEGER</td>
                                        <td></td>
                                        <td>Today's health score at this point</td>
                                    </tr>
                                    <tr>
                                        <td class="column-name">health_tomorrow</td>
                                        <td class="data-type">INTEGER</td>
                                        <td></td>
                                        <td>Tomorrow's health score</td>
                                    </tr>
                                    <tr>
                                        <td class="column-name">health_this_week</td>
                                        <td class="data-type">INTEGER</td>
                                        <td></td>
                                        <td>This week's health score</td>
                                    </tr>
                                    <tr>
                                        <td class="column-name">health_next_week</td>
                                        <td class="data-type">INTEGER</td>
                                        <td></td>
                                        <td>Next week's health score</td>
                                    </tr>
                                    <tr>
                                        <td class="column-name">health_this_month</td>
                                        <td class="data-type">INTEGER</td>
                                        <td></td>
                                        <td>This month's health score</td>
                                    </tr>
                                    <tr>
                                        <td class="column-name">health_next_month</td>
                                        <td class="data-type">INTEGER</td>
                                        <td></td>
                                        <td>Next month's health score</td>
                                    </tr>
                                    <tr>
                                        <td class="column-name">total_health_improvement</td>
                                        <td class="data-type">INTEGER</td>
                                        <td></td>
                                        <td>Sum of positive changes (end only)</td>
                                    </tr>
                                    <tr>
                                        <td class="column-name">total_actions_taken</td>
                                        <td class="data-type">INTEGER</td>
                                        <td></td>
                                        <td>Actions affecting health (end only)</td>
                                    </tr>
                                    <tr>
                                        <td class="column-name">time_saved_minutes</td>
                                        <td class="data-type">INTEGER</td>
                                        <td></td>
                                        <td>Total time saved in session</td>
                                    </tr>
                                    <tr>
                                        <td class="column-name">top_issues</td>
                                        <td class="data-type">JSONB</td>
                                        <td></td>
                                        <td>Main health issues at this point</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        <!-- Action Health Impacts Table -->
                        <div class="table-card">
                            <div class="table-header health">
                                <span>action_health_impacts</span>
                                <span class="table-type">Impact Tracking</span>
                            </div>
                            <div class="table-description">
                                Records how each user action impacts health scores. Tracks before/after scores and which flags were resolved or created by the action.
                            </div>
                            <table>
                                <thead>
                                    <tr>
                                        <th>Column</th>
                                        <th>Type</th>
                                        <th>Constraints</th>
                                        <th>Description</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td class="column-name">id</td>
                                        <td class="data-type">UUID</td>
                                        <td>
                                            <span class="constraint primary-key">PRIMARY KEY</span>
                                            <span class="constraint default">DEFAULT gen_random_uuid()</span>
                                        </td>
                                        <td>Unique identifier</td>
                                    </tr>
                                    <tr>
                                        <td class="column-name">action_id</td>
                                        <td class="data-type">UUID</td>
                                        <td>
                                            <span class="constraint not-null">NOT NULL</span>
                                            <span class="constraint foreign-key">FK â†’ user_actions.id</span>
                                            <span class="constraint index">INDEXED</span>
                                        </td>
                                        <td>Reference to the action</td>
                                    </tr>
                                    <tr>
                                        <td class="column-name">user_id</td>
                                        <td class="data-type">TEXT</td>
                                        <td>
                                            <span class="constraint not-null">NOT NULL</span>
                                            <span class="constraint foreign-key">FK â†’ users.id</span>
                                            <span class="constraint index">INDEXED</span>
                                        </td>
                                        <td>User who took action</td>
                                    </tr>
                                    <tr>
                                        <td class="column-name">calendar_id</td>
                                        <td class="data-type">TEXT</td>
                                        <td>
                                            <span class="constraint not-null">NOT NULL</span>
                                        </td>
                                        <td>Calendar affected</td>
                                    </tr>
                                    <tr>
                                        <td class="column-name">impact_type</td>
                                        <td class="data-type">TEXT</td>
                                        <td>
                                            <span class="constraint not-null">NOT NULL</span>
                                            <span class="constraint index">INDEXED</span>
                                        </td>
                                        <td>Type of impact (add_buffer, etc.)</td>
                                    </tr>
                                    <tr>
                                        <td class="column-name">time_horizon</td>
                                        <td class="data-type">TEXT</td>
                                        <td>
                                            <span class="constraint not-null">NOT NULL</span>
                                        </td>
                                        <td>Which horizon was affected</td>
                                    </tr>
                                    <tr>
                                        <td class="column-name">score_before</td>
                                        <td class="data-type">INTEGER</td>
                                        <td>
                                            <span class="constraint not-null">NOT NULL</span>
                                        </td>
                                        <td>Health score before action</td>
                                    </tr>
                                    <tr>
                                        <td class="column-name">score_after</td>
                                        <td class="data-type">INTEGER</td>
                                        <td>
                                            <span class="constraint not-null">NOT NULL</span>
                                        </td>
                                        <td>Health score after action</td>
                                    </tr>
                                    <tr>
                                        <td class="column-name">score_delta</td>
                                        <td class="data-type">INTEGER</td>
                                        <td>
                                            <span class="constraint generated">GENERATED</span>
                                        </td>
                                        <td>Computed: score_after - score_before</td>
                                    </tr>
                                    <tr>
                                        <td class="column-name">flag_type</td>
                                        <td class="data-type">TEXT</td>
                                        <td></td>
                                        <td>Which health flag was addressed</td>
                                    </tr>
                                    <tr>
                                        <td class="column-name">flag_count_before</td>
                                        <td class="data-type">INTEGER</td>
                                        <td></td>
                                        <td>Flag count before action</td>
                                    </tr>
                                    <tr>
                                        <td class="column-name">flag_count_after</td>
                                        <td class="data-type">INTEGER</td>
                                        <td></td>
                                        <td>Flag count after action</td>
                                    </tr>
                                    <tr>
                                        <td class="column-name">events_modified</td>
                                        <td class="data-type">INTEGER</td>
                                        <td>
                                            <span class="constraint default">DEFAULT 0</span>
                                        </td>
                                        <td>Number of events changed</td>
                                    </tr>
                                    <tr>
                                        <td class="column-name">details</td>
                                        <td class="data-type">JSONB</td>
                                        <td></td>
                                        <td>Additional impact context</td>
                                    </tr>
                                    <tr>
                                        <td class="column-name">created_at</td>
                                        <td class="data-type">TIMESTAMPTZ</td>
                                        <td>
                                            <span class="constraint default">DEFAULT NOW()</span>
                                            <span class="constraint index">INDEXED</span>
                                        </td>
                                        <td>When impact was recorded</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Logging Tables -->
                    <div id="logging" class="tab-content">
                        <!-- Enhanced User Actions Table -->
                        <div class="table-card">
                            <div class="table-header">
                                <span>user_actions (Enhanced)</span>
                                <span class="table-type">Enhanced Table</span>
                            </div>
                            <div class="table-description">
                                Core logging table enhanced with health score tracking columns. Records all user interactions with privacy-first design (IDs only, no PII).
                            </div>
                            <table>
                                <thead>
                                    <tr>
                                        <th>Column</th>
                                        <th>Type</th>
                                        <th>Constraints</th>
                                        <th>Description</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr style="background: #f0fdf4;">
                                        <td class="column-name">health_impact_score</td>
                                        <td class="data-type">INTEGER</td>
                                        <td>
                                            <span class="badge-health">NEW</span>
                                        </td>
                                        <td>Net health score change from action</td>
                                    </tr>
                                    <tr style="background: #f0fdf4;">
                                        <td class="column-name">health_horizons_affected</td>
                                        <td class="data-type">TEXT[]</td>
                                        <td>
                                            <span class="badge-health">NEW</span>
                                        </td>
                                        <td>Array of affected time horizons</td>
                                    </tr>
                                    <tr style="background: #f0fdf4;">
                                        <td class="column-name">health_flags_resolved</td>
                                        <td class="data-type">TEXT[]</td>
                                        <td>
                                            <span class="badge-health">NEW</span>
                                        </td>
                                        <td>Health issues fixed by action</td>
                                    </tr>
                                    <tr style="background: #f0fdf4;">
                                        <td class="column-name">health_flags_created</td>
                                        <td class="data-type">TEXT[]</td>
                                        <td>
                                            <span class="badge-health">NEW</span>
                                        </td>
                                        <td>New health issues created</td>
                                    </tr>
                                    <tr>
                                        <td class="column-name">id</td>
                                        <td class="data-type">UUID</td>
                                        <td>
                                            <span class="constraint primary-key">PRIMARY KEY</span>
                                        </td>
                                        <td>Unique action identifier</td>
                                    </tr>
                                    <tr>
                                        <td class="column-name">user_id</td>
                                        <td class="data-type">TEXT</td>
                                        <td>
                                            <span class="constraint not-null">NOT NULL</span>
                                            <span class="constraint foreign-key">FK â†’ users.id</span>
                                        </td>
                                        <td>User who performed action</td>
                                    </tr>
                                    <tr>
                                        <td class="column-name">action_category</td>
                                        <td class="data-type">TEXT</td>
                                        <td>
                                            <span class="constraint not-null">NOT NULL</span>
                                        </td>
                                        <td>Category (auth, event, workflow, etc.)</td>
                                    </tr>
                                    <tr>
                                        <td class="column-name">action_type</td>
                                        <td class="data-type">TEXT</td>
                                        <td>
                                            <span class="constraint not-null">NOT NULL</span>
                                        </td>
                                        <td>Specific action taken</td>
                                    </tr>
                                    <tr>
                                        <td class="column-name">action_status</td>
                                        <td class="data-type">TEXT</td>
                                        <td>
                                            <span class="constraint default">DEFAULT 'initiated'</span>
                                        </td>
                                        <td>Status: initiated, success, failed</td>
                                    </tr>
                                    <tr>
                                        <td class="column-name">time_saved_minutes</td>
                                        <td class="data-type">INTEGER</td>
                                        <td>
                                            <span class="constraint default">DEFAULT 0</span>
                                        </td>
                                        <td>Time saved by action</td>
                                    </tr>
                                    <tr>
                                        <td class="column-name">metadata</td>
                                        <td class="data-type">JSONB</td>
                                        <td></td>
                                        <td>Flexible action-specific data</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Existing Tables -->
                    <div id="existing" class="tab-content">
                        <!-- Users Table -->
                        <div class="table-card">
                            <div class="table-header">
                                <span>users</span>
                                <span class="table-type">Existing Table</span>
                            </div>
                            <div class="table-description">
                                Core user table that all health and logging tables reference.
                            </div>
                            <table>
                                <thead>
                                    <tr>
                                        <th>Column</th>
                                        <th>Type</th>
                                        <th>Constraints</th>
                                        <th>Description</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td class="column-name">id</td>
                                        <td class="data-type">TEXT</td>
                                        <td>
                                            <span class="constraint primary-key">PRIMARY KEY</span>
                                        </td>
                                        <td>Unique user identifier</td>
                                    </tr>
                                    <tr>
                                        <td class="column-name">email</td>
                                        <td class="data-type">TEXT</td>
                                        <td>
                                            <span class="constraint unique">UNIQUE</span>
                                        </td>
                                        <td>User email address</td>
                                    </tr>
                                    <tr>
                                        <td class="column-name">subscription_tier</td>
                                        <td class="data-type">TEXT</td>
                                        <td>
                                            <span class="constraint default">DEFAULT 'basic'</span>
                                        </td>
                                        <td>Subscription level</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Health Score Analytics -->
            <div class="section">
                <h2>
                    <span>ðŸ“Š</span>
                    Health Score Analytics Capabilities
                </h2>

                <div class="schema-diagram">
                    <h3>What This Schema Enables</h3>
                    <div class="relationships" style="margin-top: 20px;">
                        <div class="relationship-card health">
                            <div class="relationship-title">ðŸ“ˆ Score Trends</div>
                            <div class="relationship-detail">
                                Track health scores over time for each horizon. Identify patterns and predict future health.
                            </div>
                        </div>
                        <div class="relationship-card health">
                            <div class="relationship-title">ðŸŽ¯ Action Impact</div>
                            <div class="relationship-detail">
                                Measure how each action type improves or degrades calendar health.
                            </div>
                        </div>
                        <div class="relationship-card health">
                            <div class="relationship-title">ðŸ† Session Improvements</div>
                            <div class="relationship-detail">
                                Show total health improvements achieved in each user session.
                            </div>
                        </div>
                        <div class="relationship-card health">
                            <div class="relationship-title">ðŸš¨ Issue Detection</div>
                            <div class="relationship-detail">
                                Identify most common health issues and their frequency.
                            </div>
                        </div>
                        <div class="relationship-card health">
                            <div class="relationship-title">ðŸ’¡ Recommendations</div>
                            <div class="relationship-detail">
                                Generate personalized recommendations based on health patterns.
                            </div>
                        </div>
                        <div class="relationship-card health">
                            <div class="relationship-title">â±ï¸ Time Savings</div>
                            <div class="relationship-detail">
                                Correlate health improvements with time saved through actions.
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        function showTab(tabName) {
            // Remove active class from all tabs and contents
            const tabs = document.querySelectorAll('.tab');
            const contents = document.querySelectorAll('.tab-content');

            tabs.forEach(tab => tab.classList.remove('active'));
            contents.forEach(content => content.classList.remove('active'));

            // Add active class to selected tab and content
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');
        }
    </script>
</body>
</html>